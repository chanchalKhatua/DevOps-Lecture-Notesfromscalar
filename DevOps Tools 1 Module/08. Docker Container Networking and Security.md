# **Docker Container Networking and Security**

This document provides a detailed discussion on **Docker Storage**, **Storage Drivers**, **NFS (Network File System)**, and **Docker Networking**. It explains how data is stored and managed in Docker containers and how Docker networking enables interaction between isolated containers.

---

## **Topics to be discussed:**

1. Docker Storage  
2. Storage Drivers  
3. NFS (Network File System)  
4. Docker Networking  

---

# üê≥ Introduction to Docker Storage

Docker Storage refers to the methods used to **persist data** in Docker containers and manage **container file systems**.

---

### **Why Do We Need Storage in Docker?**  
1. **Data Persistence**: Ensures that data remains available even if the container is deleted.  
2. **Scalability and Flexibility**: Allows storage to be adjusted as needed for various applications.  
3. **Efficient Resource Management**: Prevents duplication of data across containers.  
4. **High Availability and Reliability**: Ensures data remains accessible during container failures.

---
## üì¶ Docker Image Layers: Read-Only  
A Docker image is made of several **read-only layers** (OS, libraries, app code). When you run a container from that image, Docker adds a **writable layer on top** of the image stack.

---

### ‚úçÔ∏è Writable Layer (Copy-on-Write):

- When a container writes to a file that exists in a lower (read-only) image layer:
  - Docker **copies that file** from the image layer into the **writable container layer**
  - The container **modifies the copy**, not the original
- This is called **Copy-on-Write (CoW)**
---
![image](https://github.com/user-attachments/assets/de74394f-1d5c-4fe1-a848-96f9fc472850)

---

### üß† Key Points:

- **Writable Layer is ephemeral**: Data is lost if the container is removed.
- **Efficient**: Only modified data is copied, saving storage space.
- **Used for**: Logs, temp files, and any non-persistent data.

---
## ‚ö° Ephemeral Storage (Temporary)

- **Exists only during container lifetime**
- Data is **lost** when the container stops or is removed
- Stored in the container's writable layer (Copy-on-Write)

### üî∏ Characteristics:
- Image layers = **Read-only**
- Container layer = **Writable**
- Best for **short-term tasks** or **stateless apps**

---

## üíæ Persistent Storage

- Survives container stop/restart/removal
- Used to **retain data** beyond container lifecycle
- Critical for **databases, user uploads, logs**, etc.

---

## üõ†Ô∏è Docker Storage Types

### 1. **Volumes** (Preferred)

- Managed by Docker
- Stored in: `/var/lib/docker/volumes/`
- Portable, safe, and works well with Docker Swarm

#### üîπ Create a volume:
```bash
docker volume create my-volume
```

#### üîπ Use volume in a container:
```bash
docker run -d -v my-volume:/data nginx
```

---

### 2. **Bind Mounts**

- Mounts a **specific path** from host into container
- Direct access to host files

#### üîπ Example:
```bash
docker run -d -v /host/data:/container/data my_image
```

#### ‚ö†Ô∏è Less Portable:
- Tightly coupled with host file system
- Not ideal for sharing across environments

---

### 3. **tmpfs Mounts** (In-Memory)

- Temporary storage in **RAM**
- Super fast, no disk I/O
- **Data lost on restart** or shutdown

#### üîπ Example:
```bash
docker run -it --rm --tmpfs /app/cache:size=64m ubuntu bash
```
---
![image](https://github.com/user-attachments/assets/61f8852a-e6fc-4e52-9631-127a9269a1ed)
---
## üìå Quick Comparison

| Type         | Persistent | Fast | Portable | Use Case                     |
|--------------|------------|------|----------|------------------------------|
| Volume       | ‚úÖ         | ‚ö™    | ‚úÖ       | Databases, logs              |
| Bind Mount   | ‚úÖ         | ‚ö™    | ‚ùå       | Host-config access, dev work |
| tmpfs        | ‚ùå         | ‚úÖ   | ‚ùå       | Caching, sensitive data      |

---



---
## **creating and managing Docker volumes**, where one container writes to the volume and another reads from it ‚Äî demonstrating shared data:

---

### üîß **1. Create a Docker Volume**
```bash
docker volume create shared-volume
```

---

### üîç **2. Inspect the Volume (Optional)**
```bash
docker volume inspect shared-volume
```

---

### üìÉ **3. List Available Volumes**
```bash
docker volume ls
```

---

### üìù **4. Launch the First Container (Writer)**
Mount the volume and get a shell:
```bash
docker run -it --name writer-container -v shared-volume:/app/data ubuntu bash
```

Now, inside the container, write data:
```bash
echo "This data is present on shared-volume!" > /app/data/message.txt
exit
```

---

### üìñ **5. Launch the Second Container (Reader)**
Also mount the same volume:
```bash
docker run -it --name reader-container -v shared-volume:/app/data ubuntu bash
```

Inside this container, read the data:
```bash
cat /app/data/message.txt
# Output: This data is present on shared-volume!
exit
```

---

### üßπ **(Optional) Cleanup**
Stop and remove containers and volume:
```bash
docker rm -f writer-container reader-container
docker volume rm shared-volume
```
This is a great basic example of **persistent data sharing** using Docker volumes.

---
---

## üß™ **Demo: Backing Up a Docker Volume Using a Temporary Container**

#### 1. **Create a backup directory on the host**
```bash
mkdir -p ~/docker-backup
```

#### 2. **(Optional) Create and use a volume**
Let‚Äôs assume you already have a named volume `shared-volume`. If not:
```bash
docker volume create shared-volume
```

#### 3. **(Optional) Add data to the volume**
You can use a temporary container to put a file into the volume:
```bash
docker run --rm -v shared-volume:/data alpine sh -c "echo 'This is a message' > /data/message.txt"
```

#### 4. **Back up the volume using a temporary container**
```bash
docker run --rm \
  -v shared-volume:/data \
  -v ~/docker-backup:/backup \
  ubuntu \
  tar -czf /backup/shared-volume-backup.tar.gz -C /data .
```

#### ‚úÖ Result:
- A compressed backup of your `shared-volume` is saved as:
```bash
~/docker-backup/shared-volume-backup.tar.gz
```
---

## ‚ôªÔ∏è **Demo: Restoring a Docker Volume Backup**

#### ‚úÖ Prerequisites:
- Backup file: `~/docker-backup/shared-volume-backup.tar.gz`
- Target volume: `shared-volume` (or any name you prefer)

---

#### 1. **Ensure the volume exists (create if needed)**

```bash
docker volume create shared-volume
```

#### 2. **Restore the backup to the volume**

```bash
docker run --rm \
  -v shared-volume:/data \
  -v ~/docker-backup:/backup \
  ubuntu \
  bash -c "cd /data && tar -xzf /backup/shared-volume-backup.tar.gz"
```

---

#### üìÇ To Verify:
You can check the contents using another temporary container:

```bash
docker run --rm -v shared-volume:/data alpine ls /data
```

You should see `message.txt` or whatever data was in the backup.

---
---

# **Storage Drivers**

Docker uses **Storage Drivers** to manage how data is **stored and accessed** in the container‚Äôs filesystem.

---

### **Types of Storage Drivers**

1. **Overlay2 (Default Driver)**  
   - Uses **Copy-on-Write** mechanism.  
   - A **base image** is shared across multiple containers, with each container having its own **read-write layer**.

   **Example:**  
   - Containers **C1**, **C2**, and **C3** use the same base image layer, but each has a unique **read-write layer** for modifications.

---

2. **AUFS (Advanced Multilayer Universal File System)**  
   - Supports **Copy-on-Write**.  
   - Combines multiple layers of files into a **unified view**.

---

3. **Device Mapper**  
   - Uses **block-level operations** to allocate storage.  
   - Ideal for systems that need **block-level management** and **high performance**.

---

### **Important Command: Cleaning Unused Volumes**  
```bash
docker volume prune
```
- Deletes **unused volumes** to free up space.

---

# **NFS (Network File System)**

### **What is NFS?**  
NFS is a **shared storage solution** that allows multiple machines to **access the same storage** over a network.

---

### **When to Use NFS?**  
- When you have **multiple machines** and want them to use **shared storage**.  
- **Example:**  
  - You have **3 servers** that need to access the **same database files**.

---

### **Setup Steps for NFS**  
1. **Install NFS Kernel on the Server**  
   ```bash
   apt-get install nfs-kernel-server
   ```
2. **Install NFS on Client Machines**  
   ```bash
   apt-get install nfs-common
   ```

---

# **Docker Networking**

Docker Networking allows **containers** to communicate with:  
- Each other.  
- The **host machine**.  
- **External networks**.

---

### **Why is Docker Networking Important?**  
- Docker containers are **isolated** by default.  
- Networking provides a **logical layer** for containers to **interact** securely.

---

### **Types of Docker Networks**

1. **Bridge Network**  
   - The **default network** for Docker containers.  
   - Containers can communicate **within the same host**.  
   - Ideal for **local development**.

2. **Host Network**  
   - Removes the **network isolation** between the container and the host.  
   - The container shares the **host‚Äôs network stack**.

3. **None Network**  
   - Completely disables networking for the container.  
   - Ideal for **security-focused** applications.

4. **Overlay Network**  
   - Used in **Docker Swarm** to enable communication between containers across **multiple hosts**.

5. **Macvlan Network**  
   - Assigns a **unique MAC address** to each container.  
   - Containers appear as **separate devices** on the network.

---

# **Summary of Key Commands**

| **Command**                            | **Description**                                     |
|----------------------------------------|-----------------------------------------------------|
| `docker volume create <name>`           | Creates a Docker volume.                           |
| `docker run -d -v <volume>:/path`       | Mounts a volume inside the container.               |
| `docker volume prune`                   | Removes unused volumes.                            |
| `docker network create <name>`          | Creates a new Docker network.                      |
| `docker network ls`                     | Lists all Docker networks.                         |
| `docker network connect <net> <cont>`   | Connects a container to a network.                 |
| `docker run --network=<network>`        | Runs a container in a specific network.             |

---

# **Example Docker Networking Commands**

1. **Creating a Bridge Network**  
   ```bash
   docker network create my_bridge
   ```

2. **Running a Container in a Custom Network**  
   ```bash
   docker run -d --name my_container --network=my_bridge nginx
   ```

3. **Inspecting a Network**  
   ```bash
   docker network inspect my_bridge
   ```

4. **Connecting an Existing Container to a Network**  
   ```bash
   docker network connect my_bridge my_container
   ```

---

# **Conclusion**

In this session, we explored:  
- **Docker Storage** methods for persisting data in containers.  
- **Storage Drivers** used to manage container filesystems.  
- **NFS (Network File System)** for shared storage across machines.  
- **Docker Networking** to enable communication between containers and external systems.
